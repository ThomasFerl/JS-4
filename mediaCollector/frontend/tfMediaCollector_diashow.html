<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Diashow mit Video-Unterstützung</title>
  <style>
    body { margin: 0; background-color: black; display: flex; justify-content: center; align-items: center; height: 100vh; }
    #viewer { max-width: 100%; max-height: 100%; }
    video, img { max-width: 100%; max-height: 100%; display: none; }
  </style>
</head>
<body>
  <div id="viewer">
    <img id="slideImage">
    <video id="slideVideo" controls></video>
  </div>

  <script>
    let mediaList = [];
    let currentIndex = 0;
    let slideInterval = 4000;
    let timer = null;
    const imageEl = document.getElementById('slideImage');
    const videoEl = document.getElementById('slideVideo');

    function isVideo(url) 
    { 
      // existiert der String "GETMOVIEFILE" in der URL?
      if (url.includes("GETMOVIEFILE")) {
        return true;
      }
    }

    function showMedia(index) 
    {
      const url = mediaList[index];
      if (isVideo(url)) 
      {
        clearInterval(timer); // Pause Slideshow
        imageEl.style.display = 'none';
        videoEl.style.display = 'block';
        videoEl.src = url;
        videoEl.play();

        videoEl.onended = () => {
          videoEl.style.display = 'none';
          nextMedia(); // Weiter nach Video-Ende
          timer = setInterval(nextMedia, slideInterval); // Fortsetzung Diashow
        };
      } else {
        videoEl.pause();
        videoEl.src = '';
        videoEl.style.display = 'none';
        imageEl.src = url;
        imageEl.style.display = 'block';
      }
    }

    function nextMedia() {
      currentIndex = (currentIndex + 1) % mediaList.length;
      showMedia(currentIndex);
    }

    //Cursor rechts ?
    function prevMedia() {
      currentIndex = (currentIndex - 1 + mediaList.length) % mediaList.length;
      showMedia(currentIndex);
    }
    //Cursor links ?
    function togglePause() {
      if (timer) {
        clearInterval(timer);
        timer = null;
      } else {
        timer = setInterval(nextMedia, slideInterval);
      }
    }
    // Event-Listener für Tasteneingaben
    document.addEventListener('keydown', (event) => {
      if (event.key === 'ArrowRight') {
        nextMedia();
      } else if (event.key === 'ArrowLeft') {
        prevMedia();
      } else if (event.key === ' ') {
        togglePause();
      }
    });
    // Event-Listener für Nachrichten vom Hauptfenster

    window.addEventListener('message', (event) => {
      mediaList = event.data.imgURLs || [];
      currentIndex = event.data.currentIndex || 0;
      slideInterval = event.data.slideInterval || 4000;

      if (mediaList.length > 0) {
        showMedia(currentIndex);
        timer = setInterval(nextMedia, slideInterval);
      }
    });
  </script>
</body>
</html>


