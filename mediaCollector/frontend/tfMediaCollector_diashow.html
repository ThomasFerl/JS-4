<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Diashow mit Video-Unterstützung</title>
  <style>
   
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background-color: black;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

#viewer {
  position: relative;
  width:100%;
  height:100%;
}

img, video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  opacity: 0.5;
  transition: opacity 1s ease-in-out;
  pointer-events: none;
}

img.show {
  opacity: 1;
  
}





  </style>
</head>
<body>
  <div id="viewer">
  <img id="slideImage">
  <video id="slideVideo" controls></video>
</div>

  <script>
    let mediaList = [];
    let currentIndex = 0;
    let slideInterval = 4000;
    let timer = null;
    const imageEl = document.getElementById('slideImage');
    const videoEl = document.getElementById('slideVideo');

    function isVideo(url) 
    { 
      // existiert der String "GETMOVIEFILE" in der URL?
      if (url.includes("GETMOVIEFILE")) {
        return true;
      }
    }

    function showMedia(index) 
    {
      const url = mediaList[index];
      if (isVideo(url)) 
      {
        imageEl.style.opacity = '0';
        imageEl.classList.remove("show");
        clearInterval(timer); // Pause Slideshow
        videoEl.style.display = 'block';
        videoEl.src = url;
        videoEl.play();

        videoEl.onended = () => {
          videoEl.style.display = 'none';
          nextMedia(); // Weiter nach Video-Ende
          timer = setInterval(nextMedia, slideInterval); // Fortsetzung Diashow
        };
      } else {
  videoEl.pause();
  videoEl.src = '';
  videoEl.style.opacity = '0';

  imageEl.classList.remove("show");
  void imageEl.offsetWidth; // Reflow erzwingen

  imageEl.src = url;

  // WICHTIG: Kein display setzen!
  imageEl.classList.add("show");
}
    }

    function nextMedia() {
      currentIndex = (currentIndex + 1) % mediaList.length;
      showMedia(currentIndex);
    }

    //Cursor rechts ?
    function prevMedia() {
      currentIndex = (currentIndex - 1 + mediaList.length) % mediaList.length;
      showMedia(currentIndex);
    }
    //Cursor links ?
    function togglePause() {
      if (timer) {
        clearInterval(timer);
        timer = null;
      } else {
        timer = setInterval(nextMedia, slideInterval);
      }
    }
    // Event-Listener für Tasteneingaben
    document.addEventListener('keydown', (event) => {
      if (event.key === 'ArrowRight') {
        nextMedia();
      } else if (event.key === 'ArrowLeft') {
        prevMedia();
      } else if (event.key === ' ') {
        togglePause();
      }
    });
    // Event-Listener für Nachrichten vom Hauptfenster

    window.addEventListener('message', (event) => {
      mediaList = event.data.imgURLs || [];
      currentIndex = event.data.currentIndex || 0;
      slideInterval = event.data.slideInterval || 4000;

      if (mediaList.length > 0) {
        showMedia(currentIndex);
        timer = setInterval(nextMedia, slideInterval);
      }
    });
  </script>
</body>
</html>


